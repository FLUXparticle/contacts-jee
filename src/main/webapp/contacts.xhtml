<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:p="http://primefaces.org/ui"
      xmlns:h="http://xmlns.jcp.org/jsf/html"
      xmlns:f="http://xmlns.jcp.org/jsf/core">
<h:head>
    <title>Contact List</title>
    <link rel="stylesheet" href="#{resource['primefaces-nova-light/theme.css']}" />
</h:head>
<h:body>

    <h:form id="form">
        <p:messages id="messages" autoUpdate="true" closable="true" />

        <p:commandButton value="Add New Contact" action="addContact?faces-redirect=true" />

        <!-- Suchfeld mit AJAX-Update -->
        <p:panelGrid columns="3" style="margin-top:10px;">
            <p:outputLabel for="search" value="Search:" />
            <p:inputText id="search" value="#{contactBean.searchQuery}"/>
            <p:commandButton value="Search" update="contactTable messages"/>
        </p:panelGrid>

        <!-- Tabelle der Kontakte -->
        <p:dataTable id="contactTable" var="contact" value="#{contactBean.lazyModel}"
                     paginator="true" rows="10" lazy="true"
                     emptyMessage="No contacts found."
                     styleClass="contact-table" style="margin-top:20px;">

            <p:ajax event="page" update="@this" />
            <p:ajax event="sort" update="@this" />

            <p:column headerText="ID" sortBy="#{contact.id}">
                <h:outputText value="#{contact.id}" />
            </p:column>
            <p:column headerText="Name" sortBy="#{contact.name}">
                <h:outputText value="#{contact.name}" />
            </p:column>
            <p:column headerText="Email" sortBy="#{contact.email}">
                <h:outputText value="#{contact.email}" />
            </p:column>
            <p:column headerText="Address" sortBy="#{contact.address}">
                <h:outputText value="#{contact.address}" />
            </p:column>
            <p:column headerText="Actions">
                <p:link value="Edit" outcome="editContact">
                    <f:param name="id" value="#{contact.id}" />
                </p:link>
                |
                <p:commandButton value="Delete" action="#{contactBean.deleteContact(contact.id)}"
                                 update="contactTable"
                                 onstart="return confirm('Are you sure you want to delete this contact?');" />
            </p:column>
            <p:column headerText="History">
                <p:commandLink value="View History" action="viewHistory">
                    <f:param name="id" value="#{contact.id}" />
                </p:commandLink>
            </p:column>
        </p:dataTable>

    </h:form>

</h:body>
</html>
